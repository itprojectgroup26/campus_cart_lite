<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login - Campus Cart Lite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/styles.css" />
    <script src="/nav.js" defer></script>
  </head>
  <body>
    <div id="navbar"></div>
    <main class="min-h-[80vh] bg-gradient-to-br from-blue-50 via-white to-blue-100/60">
      <div class="max-w-md mx-auto p-6">
        <header class="text-center mb-6">
          <h1 class="text-3xl font-extrabold text-blue-600">Welcome back</h1>
          <p class="text-gray-600">Sign in to your Campus Cart account</p>
        </header>
        <form id="login-form" class="glass rounded-2xl p-5 grid gap-4 card">
          <div class="input-wrap">
            <span class="icon">ðŸ“§</span>
            <input class="border rounded w-full px-3 py-2" type="email" name="email" placeholder="Your email" required />
          </div>
          <div class="input-wrap">
            <span class="icon">ðŸ”’</span>
            <input id="pw" class="border rounded w-full px-3 py-2" type="password" name="password" placeholder="Your password" required />
            <button id="pw-toggle" type="button" class="absolute right-3 top-1/2 -translate-y-1/2 text-sm text-blue-700 hover:underline bg-transparent p-0 m-0 cursor-pointer focus:outline-none focus:ring-0 hover:bg-transparent active:bg-transparent">Show</button>
          </div>
          <button class="bg-blue-600 hover:bg-blue-700 text-white rounded px-4 py-2">Login</button>
          <p class="text-red-600 min-h-[1.25rem]" id="login-msg"></p>
          <p class="text-sm text-gray-600">Don't have an account? <a class="text-blue-700 hover:underline" href="/signup">Create one</a></p>
        </form>
      </div>
    </main>
    <script>
      // Tweak Show/Hide button focus/hover styles to avoid blue block highlight on some browsers
      (function(){
        const t = document.getElementById('pw-toggle');
        if (t) {
          t.style.background = 'transparent';
          t.style.border = '0';
          t.style.outline = 'none';
        }
      })();
      const form = document.getElementById('login-form');
      const pw = document.getElementById('pw');
      const toggle = document.getElementById('pw-toggle');
      toggle.addEventListener('click', () => {
        if (pw.type === 'password') { pw.type = 'text'; toggle.textContent = 'Hide'; }
        else { pw.type = 'password'; toggle.textContent = 'Show'; }
      });
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(form).entries());
        const res = await fetch('/api/v1/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'same-origin',
          body: JSON.stringify(data)
        });
        const out = await res.json();
        if (res.ok) {
          location.href = '/home';
        } else {
          const msg = typeof out.msg === 'object' ? Object.values(out.msg).join(' | ') : out.msg;
          document.getElementById('login-msg').textContent = msg || 'Login failed';
        }
      });
    </script>
  </body>
</html>
